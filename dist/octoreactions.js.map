{"version":3,"sources":["Storage.js","Parser.js","Constants.js","Async.js","Views.js","Octoreactions.js","index.js"],"names":[],"mappings":"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","file":"octoreactions.js","sourcesContent":["const STORAGE_NAMESPACE = 'octoreactions';\n\n\nclass Storage {\n\n  getKey(owner, repo) {\n    return `${STORAGE_NAMESPACE}:${owner}:${repo}`;\n  }\n\n  get(key) {\n    return JSON.parse(localStorage.getItem(key))\n  }\n\n  set(key, value) {\n    const encoded = JSON.stringify(value);\n    return localStorage.setItem(key, encoded);\n  }\n\n  setIssue(owner, repo, issueId, value) {\n    const key = this.getKey(owner, repo)\n    let current = this.get(key);\n\n    if (!current) current = {};\n\n    current[issueId] = value;\n    this.set(key, current);\n  }\n\n  getIssue(owner, repo, issueId) {\n    const key = this.getKey(owner, repo);\n    const value = this.get(key);\n\n    if (value && issueId in value) return value[issueId];\n  }\n\n}\n\n","const REACTIONS_CONTAINER = '.comment-reactions-options'\nconst ISSUES_SELECTOR = '.table-list-issues li';\n\nconst DEFAULT_REACTION_COUNTS = {\n  '+1': 0, heart: 0, '-1': 0, smile: 0, thinking_face: 0, tada: 0\n}\n\nconst sumObjects = (a, b, init=0) => {\n  Object.keys(b).forEach(key => {\n    if (!a.hasOwnProperty(key)) a[key] = init;\n    a[key] += b[key];\n  })\n  return Object.assign({}, a);\n}\n\n\nclass Parser {\n\n  static getReactionsContainers($dom) {\n    return $dom.find(REACTIONS_CONTAINER)\n  }\n\n  static getReactionsCountsFromContainer($reactionsContainer) {\n    // Reactions are all the button children of the container\n    return [].map.call($reactionsContainer.children, (reactionButton) => {\n\n      // The value attribute contains the reaction type\n      const reactionType = Parser.getReactionType(reactionButton);\n      const reactionValue = Parser.getReactionValue(reactionButton);\n\n      return { [reactionType]: reactionValue }\n    })\n    .reduce(sumObjects, Object.assign({}, DEFAULT_REACTION_COUNTS))\n  }\n\n  static getReactionType(reactionButton) {\n    return reactionButton.value.split(' ')[0];\n  }\n\n  static getReactionValue(reactionButton) {\n    return +reactionButton.textContent.trim().split(' ').pop();\n  }\n\n  static getReactions($dom) {\n    return []\n      .map.call(Parser.getReactionsContainers($dom), $container => Parser.getReactionsCountsFromContainer($container))\n      .reduce(sumObjects, Object.assign({}, DEFAULT_REACTION_COUNTS))\n  }\n\n  static getIssues($dom) {\n    let issues = [];\n    $dom.find(ISSUES_SELECTOR).each((i, issue) => {\n      const href = issue.getElementsByClassName('issue-title-link')[0].href;\n      issues.push({\n        id: +href.split('/').pop(),\n        issue\n      })\n    })\n\n    return issues;\n  }\n\n}\n\n","const PLUS_SELECTOR = '.reaction-summary-item[value~=\"+1\"]'\nconst MINUS_SELECTOR = '.reaction-summary-item[value~=\"-1\"]'\nconst SMILE_SELECTOR = '.reaction-summary-item[value~=\"smile\"]'\nconst THINKING_SELECTOR = '.reaction-summary-item[value~=\"thinking_face\"]'\nconst TADA_SELECTOR = '.reaction-summary-item[value~=\"tada\"]'\nconst HEART_SELECTOR = '.reaction-summary-item[value~=\"heart\"]'\n\n\nconst REACTION_OPTION_SELECTORS = [\n  PLUS_SELECTOR,\n  MINUS_SELECTOR,\n  SMILE_SELECTOR,\n  THINKING_SELECTOR,\n  TADA_SELECTOR,\n  HEART_SELECTOR\n]\n\nconst STORAGE = 'octoreactions';\nconst OCTOREACTIONS_CLASS = 'Octoreactions';\nconst OCTOREACTIONS_COUNT_CLASS = 'Octoreactions-Count';\nconst OCTOREACTIONS_CONTAINER = '.Octoreactions';\n\nconst GITHUB_PLUS = '<g-emoji class=\"emoji mr-1\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f44d.png\">üëç</g-emoji>'\nconst GITHUB_HEART = '<g-emoji class=\"emoji mr-1\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/2764.png\">‚ù§Ô∏è</g-emoji>'\nconst GITHUB_MINUS = '<g-emoji class=\"emoji mr-1\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f44e.png\">üëé</g-emoji>'\nconst GITHUB_SMILE = '<g-emoji class=\"emoji mr-1\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png\">üòÑ</g-emoji>'\nconst GITHUB_THINKING = '<g-emoji class=\"emoji mr-1\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f615.png\">üòï</g-emoji>'\nconst GITHUB_TADA = '<g-emoji class=\"emoji mr-1\" fallback-src=\"https://assets-cdn.github.com/images/icons/emoji/unicode/1f389.png\">üéâ</g-emoji>'\n\nconst EVENT = {\n  LOCATION_CHANGE: 'octoreactions:location_change'\n}","\nclass Async {\n\n  static getIssueDOM(owner, repo, issueId) {\n    const url = `https://github.com/${owner}/${repo}/issues/${issueId}`\n    console.debug('[Octoreactions] Requesting url: ' + url)\n    return $.get(url)\n  }\n\n}","const ISSUE_HEADER_CONTAINER = '.gh-header-meta'\nconst ISSUE_HEADER_ROW = '.flex-table-item-primary'\n\nconst REACTION_TO_EMOTICON = {\n  '+1': GITHUB_PLUS,\n  heart: GITHUB_HEART,\n  '-1': GITHUB_MINUS,\n  smile: GITHUB_SMILE,\n  thinking_face: GITHUB_THINKING,\n  tada: GITHUB_TADA\n}\n\n\nclass View {\n\n  static getEmoticon(type) {\n    return REACTION_TO_EMOTICON[type];\n  }\n\n  static getPlusElement(count) {\n    return View.getCountElement('+1', count);\n  }\n\n  static getCountElement(type, count) {\n    return `\n      <span class=\"${OCTOREACTIONS_CLASS}\">\n        ${View.getEmoticon(type)}\n        <span class=\"${OCTOREACTIONS_COUNT_CLASS}\">${count}</span>\n      </span>\n    `\n  }\n\n}\n\nclass IssueDetail extends View {\n\n  static render(reactions) {\n\n    const $issueHeader = $(`${ISSUE_HEADER_CONTAINER} ${ISSUE_HEADER_ROW}`);\n    const $octoreactions = $(OCTOREACTIONS_CONTAINER);\n\n    // TODO: Handle more gracefully if exists\n    $octoreactions.remove();\n\n    Object.keys(reactions).forEach(type => {\n      const elem = View.getCountElement(type, reactions[type]);\n      $issueHeader.append(elem);\n    })\n  }\n\n\n}\n\nclass IssueList extends View {\n\n  static render(reactions, $issue) {\n    debugger;\n    const $commentsContainer = $($issue).find('.issue-comments');\n    const octoreactions = $commentsContainer.find(OCTOREACTIONS_CONTAINER);\n\n    octoreactions.remove();\n\n    $commentsContainer.append(View.getPlusElement(reactions['+1']));\n  }\n\n}\n","const REACTIONS_DEFAULT = {\n  '+1': true,\n  '-1': false,\n  heart: false,\n  smile: false,\n  tada: false,\n  thinking_face: false\n}\n\nconst CACHE_DEFAULT = 10\nconst DEFAULT_SETTINGS = {\n  reactions: REACTIONS_DEFAULT,\n  cache: CACHE_DEFAULT\n}\n\nconst initialState = {\n  owner: null,\n  repo: null,\n  issueId: null,\n  settings: DEFAULT_SETTINGS\n}\n\n\nclass Octoreactions {\n\n  constructor(state=initialState) {\n    this.state = state;\n\n    this.storage = new Storage();\n\n    this.updateState();\n    this.render();\n  }\n\n  updateState(pathname=window.location.pathname) {\n\n    let [_, owner, repo, issues, issueId] = pathname.split('/')\n    this.state = Object.assign({}, this.state, {owner, repo, issueId})\n  }\n\n  setSettings(settings=DEFAULT_SETTINGS) {\n    this.state = Object.assign({}, this.state, settings);\n  }\n\n  updateAndRender() {\n    this.updateState();\n    this.render();\n  }\n\n  render() {\n    const state = this.state;\n    const isIssueList = !state.issueId;\n    const self = this;\n\n    if (isIssueList) {\n\n      const issues = Parser.getIssues($(document));\n      const {owner, repo} = this.state;\n\n      issues.forEach(({id, issue}) => {\n        this.getReactionsFromStore(owner, repo, id)\n          .then(r => r, () => Async.getIssueDOM(owner, repo, id)\n            .then(dom => {\n              let reactions = Parser.getReactions($(dom));\n              self.storage.setIssue(owner, repo, id, reactions)\n              return new Promise(resolve => resolve(reactions));\n            })\n          )\n          .then(reactions => IssueList.render(reactions, issue))\n      })\n    }\n\n\n    else {\n      const {owner, repo, issueId} = this.state;\n      this.getReactionsFromStore(owner, repo, issueId)\n        .then(r => r, () => {\n          debugger;\n          let reactions = Parser.getReactions($(document));\n          this.storage.setIssue(owner, repo, issueId, reactions)\n          return new Promise(resolve => resolve(reactions));\n        })\n        .then(reactions => {\n          let reactionsCopy = Object.assign({}, reactions);\n          Object.keys(reactionsCopy).forEach(key => {\n            // debugger;\n            if (!state.settings.reactions[key]) delete reactionsCopy[key];\n          })\n          return reactionsCopy\n        })\n        .then(reactions => IssueDetail.render(reactions))\n    }\n  }\n\n  getReactionsFromStore(owner, repo, issueId) {\n    return new Promise((resolve, reject) => {\n      const reactions = this.storage.getIssue(owner, repo, issueId);\n      return reactions ? resolve(reactions) : reject();\n    })\n  }\n\n}\n","jQuery(document).ready(function ($) {\n\n  const GH_PJAX_CONTAINER_SEL = '#js-repo-pjax-container, .context-loader-container, [data-pjax-container]'\n\n  if (!window.octoreactions) {\n    window.octoreactions = new Octoreactions();\n    window.octoreactions.updateAndRender();\n  }\n\n  // Setup observers\n  const pageChangeObserver = new window.MutationObserver(() => {\n    window.octoreactions.updateAndRender();\n  })\n\n  const pjaxContainer = $(GH_PJAX_CONTAINER_SEL)[0]\n\n  if (pjaxContainer) pageChangeObserver.observe(pjaxContainer, {\n    childList: true,\n  })\n\n  chrome.storage.onChanged.addListener((changes, areaName) => {\n    if (areaName === 'sync') {\n      chrome.storage.sync.get(['cache', 'reactions'], (vals) => {\n        debugger;\n        window.octoreactions.setSettings(vals);\n        window.octoreactions.render();\n      })\n    }\n\n  });\n\n});"],"sourceRoot":"/source/"}